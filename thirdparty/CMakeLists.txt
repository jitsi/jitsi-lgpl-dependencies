include(ExternalProject)

set(external_download_dir ${CMAKE_SOURCE_DIR}/target/downloads)

if(USE_SYSTEM_FFMPEG)
    pkg_check_modules(LIBAVUTIL libavutil>=54 REQUIRED)
    pkg_check_modules(LIBAVCODEC libavcodec>=56 REQUIRED)
    pkg_check_modules(LIBAVFORMAT libavformat>=56 REQUIRED)
    pkg_check_modules(LIBAVFILTER libavfilter>=5 REQUIRED)
    pkg_check_modules(LIBSWSCALE libswscale>=3 REQUIRED)
else()
    if(USE_SYSTEM_OPENH264)
        pkg_check_modules(LIBOPENH264 openh264>=1.7.0 REQUIRED)
    else()
        include(External_openh264)
        set(LIBOPENH264_INCLUDE_DIRS ${LIBOPENH264_INCLUDE_DIRS} PARENT_SCOPE)
        set(LIBOPENH264_LIBRARY_DIRS ${LIBOPENH264_LIBRARY_DIRS} PARENT_SCOPE)
    endif()

    if(USE_SYSTEM_LAME)
        find_package(LIBMP3LAME REQUIRED)
    else()
        include(External_lame)
        set(libmp3lame_INCLUDE_DIRS ${libmp3lame_INCLUDE_DIRS} PARENT_SCOPE)
        set(libmp3lame_LIBRARY_DIRS ${libmp3lame_LIBRARY_DIRS} PARENT_SCOPE)
    endif()

    include(External_ffmpeg)
    set(FFMPEG_INCLUDE_DIRS ${FFMPEG_INCLUDE_DIRS} PARENT_SCOPE)
    set(FFMPEG_LIBRARY_DIRS ${FFMPEG_LIBRARY_DIRS} PARENT_SCOPE)
    set(FFMPEG_OH264_INCLUDE_DIRS ${FFMPEG_OH264_INCLUDE_DIRS} PARENT_SCOPE)
    set(FFMPEG_OH264_LIBRARY_DIRS ${FFMPEG_OH264_LIBRARY_DIRS} PARENT_SCOPE)

    if(NOT USE_SYSTEM_OPENH264)
        add_dependencies(ffmpeg_OH264 openh264)
    endif()

    if(NOT USE_SYSTEM_LAME)
        add_dependencies(ffmpeg lame)
        add_dependencies(ffmpeg_OH264 lame)
    endif()
endif()
